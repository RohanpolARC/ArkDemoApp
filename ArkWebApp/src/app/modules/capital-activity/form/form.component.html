
  <form [formGroup]="form" autocomplete="off">

    <ng-template #totalAmount>
      <mat-form-field appearance="outline" class="col-4">
        <mat-label> Total Amount (Fund Ccy) </mat-label>
        <input type="text" required matInput InputAmountNumber formControlName="totalAmount" />
        <button matSuffix mat-icon-button aria-label="Clear" type="button"  (click)="form.get('totalAmount').reset()">
            <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </ng-template>
    
    <ng-template #narrative>
      <mat-form-field appearance="outline" class="col-4">
        <mat-label>Narrative</mat-label>
        <input matInput formControlName="narrative" />
        <button matSuffix mat-icon-button aria-label="Clear" type="button"  (click)="form.get('narrative').reset()">
            <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </ng-template>
    
    <ng-template #empty>
      <div class="col-4"></div>
    </ng-template>
    
    <ng-template #issuer>
      <mat-form-field appearance="outline" class="col-4">
        <mat-label>Issuer</mat-label>
        <input type="text" matInput formControlName="issuerShortName" [matAutocomplete]="autoissuer" matAutocompletePosition="below">
        <mat-error *ngIf="form.get('issuerShortName').invalid">Please select issuer from the list</mat-error>
        <mat-autocomplete #autoissuer="matAutocomplete" (optionSelected)='issuerSelect($event)'  panelWidth="auto" class="capital-autocomplete-panel" classList="capital-autocomplete-panel">
          <mat-option
            *ngFor="let ISS of issuerFilteredOptions | async"
            [value]="ISS[1]"
            (click)="setIssuerID(ISS)"
          >
            {{ISS[0]}}
          </mat-option>
        </mat-autocomplete>
        <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('issuerShortName').reset();
        formUtilSvc.selectedIssuerID = null">
            <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </ng-template>
    
    <ng-template #asset>
      <mat-form-field appearance="outline" class="col-4">
        <mat-label>Asset</mat-label>
        <input type="text" matInput formControlName="asset" [matAutocomplete]="autoAsset" matAutocompletePosition="below">
        <mat-error *ngIf="form.get('asset').invalid">Please select asset from the list</mat-error>
      
        <mat-autocomplete autoActiveFirstOption #autoAsset="matAutocomplete" class="capital-autocomplete-panel" classList="capital-autocomplete-panel"  panelWidth="auto">
          <mat-option
            *ngFor="let asset of assetFilteredOptions | async"
            [value]="asset[0]"
            (click)="setAssetID(asset)"
          >
            {{ asset[0] }}
          </mat-option>
        </mat-autocomplete>
        <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('asset').reset(); formUtilSvc.selectedAssetID = null;">
            <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </ng-template>
    


    <div class="row">
        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Call Date</mat-label>
          <input matInput formControlName="callDate" [matDatepicker]="callDatePicker" required />
          <mat-datepicker-toggle
            matSuffix
            [for]="callDatePicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #callDatePicker></mat-datepicker>
          <button matSuffix mat-icon-button type="button" aria-label="Clear" (click)="form.get('callDate').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Value Date</mat-label>
          <input matInput required formControlName="valueDate" [matDatepicker]="valueDatePicker" />
          <mat-datepicker-toggle matSuffix [for]="valueDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #valueDatePicker></mat-datepicker>
          <button matSuffix mat-icon-button aria-label="Clear" type="button"  (click)="form.get('valueDate').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <!-- For embedding ng-template without condition on ng-container
          https://stackoverflow.com/a/52443923
         -->
        <ng-container *ngTemplateOutlet="empty"></ng-container>
    </div>

    <div class="row">

        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Capital Type</mat-label>
          <input type="text" matInput required formControlName="capitalType" [matAutocomplete]="autoCapitalType" matAutocompletePosition="below">
          <mat-error *ngIf="form.get('capitalType').invalid">Please select capital type from the list</mat-error>
          <mat-autocomplete autoActiveFirstOption #autoCapitalType="matAutocomplete" panelWidth="auto">
            <mat-option
              *ngFor="let capitalType of capitalTypeFilteredOptions | async"
              [value]="capitalType"
            >
              {{capitalType}}
            </mat-option>
          </mat-autocomplete>
          <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('capitalType').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
  
        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Capital SubType</mat-label>
          <input type="text" matInput required formControlName="capitalSubType" [matAutocomplete]="autoSubType" matAutocompletePosition="below">
          <mat-error *ngIf="form.get('capitalSubType').invalid">Please select capital subtype from the list</mat-error>
          <mat-autocomplete autoActiveFirstOption #autoSubType="matAutocomplete" panelWidth="auto">
            <mat-option
              *ngFor="let subtype of capitalSubTypeFilteredOptions | async"
              [value]="subtype"
            >
              {{subtype}}
            </mat-option>
          </mat-autocomplete>
          <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('capitalSubType').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <ng-container *ngIf="hideIssuerAndAsset(); then totalAmount else empty">
        </ng-container>

    </div>

    <div class="row">

        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Fund Hedging</mat-label>
          <input type="text" matInput required formControlName="fundHedging" [matAutocomplete]="auto" matAutocompletePosition="below">
          <mat-error *ngIf="form.get('fundHedging').invalid">Please select fund hedging from the list</mat-error>
          <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete" (optionSelected)='fundHedgingSelect($event)'  panelWidth="auto">
            <mat-option
              *ngFor="let fundHedging of fundHedgingFilteredOptions | async"
              [value]="fundHedging"
            >
              {{fundHedging}}
            </mat-option>
          </mat-autocomplete>
          <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('fundHedging').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-4">
          <mat-label>
            Fund Currency
          </mat-label>
  
          <input type="text" matInput required formControlName="fundCcy" [matAutocomplete]="autoFundCcy" matAutocompletePosition="below" [readonly]="form.get('asset').value">
          <mat-error *ngIf="form.get('fundCcy').invalid">Please select fund currency from the list</mat-error>
          <mat-autocomplete autoActiveFirstOption #autoFundCcy="matAutocomplete" panelWidth="auto">
            <mat-option
              *ngFor="let ccy of fundCcyFilteredOptions | async"
              [value]="ccy"
            >
              {{ccy}}
            </mat-option>
          </mat-autocomplete>
          <button matSuffix mat-icon-button aria-label="Clear"  type="button" (click)="form.get('fundCcy').reset()">
              <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>

        <ng-container *ngIf="hideIssuerAndAsset(); then narrative else totalAmount">          
        </ng-container>

    </div>
    <div class="row">
        <ng-container *ngIf="!hideIssuerAndAsset(); then issuer"></ng-container>

        <ng-container *ngIf="!hideIssuerAndAsset(); then asset"></ng-container>

        <ng-container *ngIf="!hideIssuerAndAsset(); then narrative"></ng-container>
    
    </div>
  </form>